"use strict";
var RemovalPricing = { isFormValid: !0 };
var monthlyPage = 0;
var lifetimePage = 0;
(function ($) {
  RemovalPricing.init = function () {
    var content_inner = $(".content-inner"),
      pricing_container = $(".rm-pricing-container", content_inner),
      pricing_inner = $(".rm-pricing-inner", content_inner);
    RemovalMain.registerOnClick($(".rm-pricing"));
    RemovalMain.registerOnClick($(".rm-pricing__unlimited--form"));
    if ($("#pay_monthly").is(":checked")) {
      var now = new Date();
      now.setMonth(now.getMonth() + 1);
      $(".pay_monthly_label")
        .show()
        .find("span")
        .html(
          now.toLocaleDateString("en-GB", {
            month: "short",
            day: "numeric",
            year: "numeric",
          })
        );
    }
    $("#pay_monthly").on("change", function () {
      var now = new Date();
      now.setMonth(now.getMonth() + 1);
      if ($("#pay_monthly").is(":checked")) {
        $(".pay_monthly_label")
          .show()
          .find("span")
          .html(
            now.toLocaleDateString("en-GB", {
              month: "short",
              day: "numeric",
              year: "numeric",
            })
          );
      } else {
        $(".pay_monthly_label").hide();
      }
    });
  };
  RemovalPricing.itemClick = function (self) {
    var package_item = self.closest(".rm-pricing--package-list"),
      pricing_item = self.closest(".rm-pricing__table"),
      radio = $("input.rm-pricing--package-input", self),
      avg = $("span.rm-pricing--package-avg", self).attr("data-avg");
    $(self)
      .parents(".rm-pricing--package-list")
      .find(".rm-pricing--package.active")
      .removeClass("active");
    $(self).addClass("active");
    $("input.rm-pricing--package-input", package_item).prop("checked", !1);
    radio.prop("checked", !0);
    $(".rm-pricing--average-price", pricing_item).html("$" + avg);
    var nextPackage = self[0]?.nextElementSibling;
    if (nextPackage && nextPackage.classList.contains("hidden")) {
      if (nextPackage.classList.contains("rm-pricing--package-monthly")) {
        var monthlyShowMore = document.getElementById("monthlyShowmore");
        var monthlyPackages = document.getElementsByClassName(
          "rm-pricing--package-monthly"
        );
        monthlyPage += 2;
        if (monthlyPage > 0) {
          for (let step = 1; step <= 2; step++) {
            let index = 2 + step + monthlyPage;
            if (monthlyPackages[index]) {
              monthlyPackages[index].classList.remove("hidden");
            }
            if (index >= monthlyPackages.length) {
              monthlyShowMore.style.display = "none";
            }
          }
        }
      }
      if (nextPackage.classList.contains("rm-pricing--package-lifetime")) {
        var lifetimeShowMore = document.getElementById("lifetimeShowmore");
        var lifetimePackages = document.getElementsByClassName(
          "rm-pricing--package-lifetime"
        );
        lifetimePage += 2;
        if (lifetimePage > 0) {
          for (let step = 1; step <= 2; step++) {
            let index = 2 + step + lifetimePage;
            if (lifetimePackages[index]) {
              lifetimePackages[index].classList.remove("hidden");
            }
            if (index >= lifetimePackages.length) {
              lifetimeShowMore.style.display = "none";
            }
          }
        }
      }
    }
  };
  RemovalPricing.processSubscribe = function (self) {
    var item_wrap = self.closest(".rm-pricing__table"),
      pd_id = $(".rm-pricing--package-input:checked", item_wrap).val(),
      pay_monthly =
        $("input#pay_monthly").length > 0 &&
        typeof $("input#pay_monthly").val() != "undefined" &&
        $("input#pay_monthly").is(":checked")
          ? 1
          : 0,
      link_login = self.attr("data-login");
    if (typeof link_login != "undefined" && link_login != "") {
      window.location.href = link_login;
    }
    if (typeof pd_id == "undefined" || pd_id == "") {
      return;
    }
    RemovalMain.showProcess(self);
    $(".rm-subscribe-message", item_wrap).addClass("rm-hidden");
    $.ajax({
      url: RemovalMain.data.ajax_url,
      type: "POST",
      data: {
        action: "rm_pricing_subscribe",
        pd_id: pd_id,
        pay_monthly: pay_monthly,
        s_field: RemovalMain.data.ajax_s_field,
      },
      success: function (response) {
        response = $.parseJSON(response);
        if (
          response.result >= 0 &&
          typeof response.redirect_url != "undefined" &&
          response.redirect_url != ""
        ) {
          window.location.href = response.redirect_url;
        } else {
          RemovalMain.closeProcess(self);
          if (typeof response.message != "undefined") {
            $(".rm-subscribe-message", item_wrap)
              .html(response.message)
              .removeClass("rm-hidden");
          } else {
            $(".rm-subscribe-message", item_wrap)
              .html(RemovalMain.data.error_message)
              .removeClass("rm-hidden");
          }
        }
      },
      error: function () {
        RemovalMain.closeProcess(self);
        $(".m-subscribe-message", item_wrap)
          .html(RemovalMain.data.error_message)
          .removeClass("rm-hidden");
      },
    });
  };
  RemovalPricing.gotoContact = function (self) {
    window.location.href = self.attr("data-link");
  };
  RemovalPricing.signUpFree = function (self) {
    if ($("body").hasClass("logged-in")) {
      window.location.href = window.location.origin + "/my-account";
    } else {
      window.location.href = window.location.origin + "/login";
    }
  };
  RemovalPricing.unlimitedRequest = function () {
    let c_email = $("#c_email").val(),
      c_name = $("#c_name").val(),
      c_note = $("#c_note").val();
    let emailErrorElement = $(".rm-pricing__unlimited-email-error");
    let nameErrorElement = $(".rm-pricing__unlimited-name-error");
    let noteErrorElement = $(".rm-pricing__unlimited-note-error");
    let errorElement = $(".rm-pricing__unlimited-error");
    let successElement = $(".rm-pricing__unlimited-success");
    if (c_name == "" || !c_name) {
      nameErrorElement.html("* Please enter your name");
      return;
    }
    if (c_email == "" || !c_email) {
      emailErrorElement.html("* Please enter your email");
      return;
    }
    let regex = /^([_\-\.0-9a-zA-Z]+)@([_\-\.0-9a-zA-Z]+)\.([a-zA-Z]){2,7}$/;
    if (!regex.test(c_email)) {
      emailErrorElement.html("* Please enter a valid email address");
      return;
    }
    if (c_note == "" || !c_note) {
      noteErrorElement.html("* Please briefly describe your use case");
      return;
    }
    emailErrorElement.html("");
    nameErrorElement.html("");
    noteErrorElement.html("");
    errorElement.html("");
    $.ajax({
      url: RemovalMain.data.ajax_url,
      type: "POST",
      data: {
        action: "rm_unlimited_request",
        c_email: c_email,
        c_name: c_name,
        c_note: c_note,
      },
      success: function (response) {
        response = $.parseJSON(response);
        $("#c_email").val("");
        $("#c_name").val("");
        $("#c_note").val("");
        successElement.html(
          "Your request has been forwarded, we will reply to you as soon as possible"
        );
      },
      error: function () {
        errorElement.html("An unknown error has occurred");
      },
    });
  };
  RemovalPricing.questionEvent = function () {
    var coll = document.getElementsByClassName("rm-pricing__question-title");
    var i;
    for (i = 0; i < coll.length; i++) {
      coll[i].addEventListener("click", function () {
        this.classList.toggle("active");
        var content = this.nextElementSibling;
        if (content.style.display === "block") {
          content.style.display = "none";
        } else {
          content.style.display = "block";
        }
      });
    }
  };
  RemovalPricing.showMorePackage = function () {
    var monthlyShowMore = document.getElementById("monthlyShowmore");
    var monthlyPackages = document.getElementsByClassName(
      "rm-pricing--package-monthly"
    );
    monthlyShowMore.addEventListener("click", function () {
      monthlyPage += 2;
      if (monthlyPage > 0) {
        for (let step = 1; step <= 2; step++) {
          let index = 2 + step + monthlyPage;
          if (monthlyPackages[index]) {
            monthlyPackages[index].classList.remove("hidden");
          }
          if (index >= monthlyPackages.length) {
            monthlyShowMore.style.display = "none";
          }
        }
      }
    });
    var lifetimeShowMore = document.getElementById("lifetimeShowmore");
    var lifetimePackages = document.getElementsByClassName(
      "rm-pricing--package-lifetime"
    );
    lifetimeShowMore.addEventListener("click", function () {
      lifetimePage += 2;
      if (lifetimePage > 0) {
        for (let step = 1; step <= 2; step++) {
          let index = 2 + step + lifetimePage;
          if (lifetimePackages[index]) {
            lifetimePackages[index].classList.remove("hidden");
          }
          if (index >= lifetimePackages.length) {
            lifetimeShowMore.style.display = "none";
          }
        }
      }
    });
  };
  $(document).ready(function () {
    RemovalPricing.init();
    RemovalPricing.questionEvent();
    RemovalPricing.showMorePackage();
  });
})(jQuery);
